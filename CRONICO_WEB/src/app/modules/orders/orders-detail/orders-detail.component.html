<!-- Header -->
<app-header
  [title]="'Pedido ' + (state$ | async).currentSubscription.name"
  [icon]="'fa-arrow-left'"
  [openSidebar]="false"
  [link]="'/orders'"
></app-header>
<!--Banner-->
<section class="normal-padding">
  <div class="box" *ngIf="!showQuantity && !showDelivery">
    <div class="row gtr-200">
      <ul class="alt items">
        <li>
          <p>
            <span> Estatus</span>
            <span
              *ngIf="(state$ | async).currentSubscription.subscriptionStatus"
            >
              <b>{{
                (state$ | async).currentSubscription.subscriptionStatus.name
              }}</b>
            </span>
          </p>
        </li>
        <li>
          <p>
            <span> Periodo</span>
            <span>
              <b> {{ (state$ | async).currentSubscription.period }} dias</b>
            </span>
          </p>
        </li>
        <li *ngIf="(state$ | async).currentSubscription.nextDelivery">
          <p>
            <span>Inicio de subscripción</span>
            <span
              ><b>
                {{
                  (state$ | async).currentSubscription.createdAt
                    | date : "dd/MM/yyyy"
                }}</b
              >
            </span>
          </p>
        </li>
        <li *ngIf="(state$ | async).currentSubscription.nextDelivery">
          <p>
            <span> Siguiente entrega</span>
            <span
              ><b>
                {{
                  (state$ | async).currentSubscription.nextDelivery
                    | date : "dd/MM/yyyy"
                }}</b
              >
            </span>
          </p>
        </li>
      </ul>
    </div>
  </div>

  <div class="box" *ngIf="showQuantity">
    <app-order-edit-form
      #editSubDetail
      [subscription]="(state$ | async).currentSubscription"
      [showQuantity]="true"
      (updateDateDelivery)="updateDateDelivery($event)"
      (updateQuantities)="updateQuantities($event)"
    >
    </app-order-edit-form>
  </div>
  <div class="box" *ngIf="showDelivery">
    <app-order-edit-form
      #editSubDetail
      [subscription]="(state$ | async).currentSubscription"
      [showDelivery]="true"
      (updateDateDelivery)="updateDateDelivery($event)"
      (updateQuantities)="updateQuantities($event)"
    >
    </app-order-edit-form>
  </div>
  <div class="box">
    <table>
      <thead>
        <tr>
          <th style="width: 30%"></th>
          <th>Cajas</th>
          <th>Costo</th>
          <th>Subtotal</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of (state$ | async).currentSubscription.items">
          <td>
            <b>{{ item.product.name }}</b
            ><br />
            {{ item.product.description }}
          </td>
          <td>{{ item.pieces }}</td>
          <td>${{ item.price }}</td>
          <td>${{ item.subtotal }}</td>
        </tr>
      </tbody>
      <tfoot>
        <tr>
          <td colspan="2"></td>
          <td>Subtotal</td>
          <td>${{ (state$ | async).currentSubscription.subtotal }}</td>
        </tr>
        <tr>
          <td colspan="2"></td>
          <td>Total</td>
          <td>
            <b>${{ (state$ | async).currentSubscription.total }}</b>
          </td>
        </tr>
      </tfoot>
    </table>
  </div>
  <div class="box">
    <div class="row gtr-200">
      <h3>Detalles de entrega</h3>
      <h4>Dirección</h4>
      <ul class="alt items">
        <li *ngIf="(state$ | async).currentSubscription.lastOrder">
          <p>
            <span
              ><b>
                {{ (state$ | async).currentSubscription.lastOrder.location }}</b
              ><br />
              <b>
                {{ (state$ | async).currentSubscription.lastOrder.comments }}</b
              ><br />
              <b>
                {{
                  (state$ | async).currentSubscription.lastOrder.reference
                }}</b
              >
              <br />
              <b>
                Horario:
                {{
                  (state$ | async).currentSubscription.lastOrder.rangeTimes
                }}</b
              >
            </span>
          </p>
        </li>
      </ul>
      <h4>Metodo de pago</h4>
      <ul class="alt items">
        <li *ngIf="(state$ | async).currentSubscription.lastOrder.card">
          <p>
            <span
              ><b>
                {{
                  (state$ | async).currentSubscription.lastOrder.card.bank_name
                }}</b
              ><br />
              <b>
                {{
                  (state$ | async).currentSubscription.lastOrder.card
                    .card_number
                }}</b
              ><br />
              <b>
                {{
                  (state$ | async).currentSubscription.lastOrder.card
                    .expiration_month
                }}
                /{{
                  (state$ | async).currentSubscription.lastOrder.card
                    .expiration_year
                }}</b
              >
            </span>
          </p>
        </li>
      </ul>
    </div>
  </div>
</section>
